import{S as mt,i as ct,f as he,b as Y,d as K,m as Z,t as L,a as R,e as x,g as Ke,c as Ze}from"../chunks/index.a2391391.js";import{f as _t,c as pt,a as gt,d as kt}from"../chunks/index.fb010e26.js";import{s as ht,w as be,A as ve,p as Pe,C as y,x as N,t as U,D as $,b as T,d as b,z as O,l as F,e as I,i as X,f as c,m as re,E as yt,J as Ge,a6 as $t,N as rt,H as Je,n as Ne,G as St}from"../chunks/scheduler.ee52cacd.js";import{e as Le,u as bt,f as At,a as Et}from"../chunks/each.4f9c2159.js";import{g as Pt}from"../chunks/navigation.4bf4851d.js";import{p as qt}from"../chunks/stores.5de49fb7.js";import{P as Dt}from"../chunks/index.691cdcca.js";import{R as Tt}from"../chunks/index.f39bbea9.js";import{M as Ct}from"../chunks/index.bf0b6763.js";import{P as Re,V as je}from"../chunks/index.550ce75a.js";import{S as Qe,P as Mt,u as Xe,d as Gt,a as Nt,f as Ot}from"../chunks/index.4b0b47d9.js";import{s as Me}from"../chunks/store.21c1b842.js";import{u as Bt,T as Vt}from"../chunks/TextArea.af35e63e.js";import{Q as at}from"../chunks/index.523fac41.js";import{t as vt}from"../chunks/translations.f943b7b3.js";import{O as Wt,a as Lt}from"../chunks/OverflowMenuItem.fb1aab9d.js";import{T as Rt}from"../chunks/Tag.87ac45b2.js";import{D as jt}from"../chunks/Dropdown.2e34ff7a.js";import{C as Ut}from"../chunks/index.5d9eba69.js";import{C as Ft,P as zt}from"../chunks/index.fc85f1f4.js";import{c as Ht}from"../chunks/store.f203a796.js";import{f as Jt}from"../chunks/function.53788a56.js";import"../chunks/supabase.2c784bff.js";import{t as Qt}from"../chunks/org.1ee4885a.js";import{S as Ye}from"../chunks/SkeletonPlaceholder.85251fa5.js";(function(){try{var s=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new Error().stack;t&&(s._sentryDebugIds=s._sentryDebugIds||{},s._sentryDebugIds[t]="e9808533-2ff6-418f-80aa-bfad76af7e79",s._sentryDebugIdIdentifier="sentry-dbid-e9808533-2ff6-418f-80aa-bfad76af7e79")}catch{}})();const Xt=({params:s={id:""}})=>({courseId:s.id}),zs=Object.freeze(Object.defineProperty({__proto__:null,load:Xt},Symbol.toStringTag,{value:"Module"}));function Yt(s){let t,e,n,a,i,o;function r(_){s[24](_)}function l(_){s[25](_)}function u(_){s[26](_)}function f(_){s[27](_)}let m={questions:Array.isArray(s[0].questions)?s[0].questions.sort(ot):[],questionnaireMetaData:{answers:s[0].answers||{},isFinished:!0},disableGrading:!1};return s[0].questionAnswerByPoint!==void 0&&(m.grades=s[0].questionAnswerByPoint),s[7]!==void 0&&(m.reasons=s[7]),s[2]!==void 0&&(m.isGradeWithAI=s[2]),s[8]!==void 0&&(m.isLoading=s[8]),t=new Mt({props:m}),be.push(()=>he(t,"grades",r)),be.push(()=>he(t,"reasons",l)),be.push(()=>he(t,"isGradeWithAI",u)),be.push(()=>he(t,"isLoading",f)),{c(){Y(t.$$.fragment)},l(_){K(t.$$.fragment,_)},m(_,d){Z(t,_,d),o=!0},p(_,d){const v={};d[0]&1&&(v.questions=Array.isArray(_[0].questions)?_[0].questions.sort(ot):[]),d[0]&1&&(v.questionnaireMetaData={answers:_[0].answers||{},isFinished:!0}),!e&&d[0]&1&&(e=!0,v.grades=_[0].questionAnswerByPoint,ve(()=>e=!1)),!n&&d[0]&128&&(n=!0,v.reasons=_[7],ve(()=>n=!1)),!a&&d[0]&4&&(a=!0,v.isGradeWithAI=_[2],ve(()=>a=!1)),!i&&d[0]&256&&(i=!0,v.isLoading=_[8],ve(()=>i=!1)),t.$set(v)},i(_){o||(L(t.$$.fragment,_),o=!0)},o(_){R(t.$$.fragment,_),o=!1},d(_){x(t,_)}}}function Kt(s){let t,e,n=s[14]("delete_modal.content")+"",a,i,o,r,l,u,f;return r=new Re({props:{className:"px-6 py-3",variant:je.OUTLINED,label:s[14]("delete_modal.no"),onClick:s[23],isDisabled:s[13]}}),u=new Re({props:{className:"px-6 py-3",variant:je.OUTLINED,label:s[14]("delete_modal.yes"),onClick:s[17],isLoading:s[13]}}),{c(){t=y("div"),e=y("h1"),a=U(n),i=N(),o=y("div"),Y(r.$$.fragment),l=N(),Y(u.$$.fragment),this.h()},l(m){t=$(m,"DIV",{class:!0});var _=T(t);e=$(_,"H1",{class:!0});var d=T(e);a=F(d,n),d.forEach(b),i=O(_),o=$(_,"DIV",{class:!0});var v=T(o);K(r.$$.fragment,v),l=O(v),K(u.$$.fragment,v),v.forEach(b),_.forEach(b),this.h()},h(){I(e,"class","dark:text-white text-lg"),I(o,"class","mt-5 flex items-center justify-between"),I(t,"class","w-96 mx-auto p-3 border border-gray-300 rounded-md")},m(m,_){X(m,t,_),c(t,e),c(e,a),c(t,i),c(t,o),Z(r,o,null),c(o,l),Z(u,o,null),f=!0},p(m,_){(!f||_[0]&16384)&&n!==(n=m[14]("delete_modal.content")+"")&&re(a,n);const d={};_[0]&16384&&(d.label=m[14]("delete_modal.no")),_[0]&4096&&(d.onClick=m[23]),_[0]&8192&&(d.isDisabled=m[13]),r.$set(d);const v={};_[0]&16384&&(v.label=m[14]("delete_modal.yes")),_[0]&8192&&(v.isLoading=m[13]),u.$set(v)},i(m){f||(L(r.$$.fragment,m),L(u.$$.fragment,m),f=!0)},o(m){R(r.$$.fragment,m),R(u.$$.fragment,m),f=!1},d(m){m&&b(t),x(r),x(u)}}}function Zt(s){let t,e=s[14]("course.navItem.submissions.grading_modal.late")+"",n;return{c(){t=y("span"),n=U(e),this.h()},l(a){t=$(a,"SPAN",{class:!0});var i=T(t);n=F(i,e),i.forEach(b),this.h()},h(){I(t,"class","ml-2 badge text-sm rounded-sm px-2 bg-red-500 text-white svelte-bvxti")},m(a,i){X(a,t,i),c(t,n)},p(a,i){i[0]&16384&&e!==(e=a[14]("course.navItem.submissions.grading_modal.late")+"")&&re(n,e)},d(a){a&&b(t)}}}function xt(s){let t,e=s[14]("course.navItem.submissions.grading_modal.early")+"",n;return{c(){t=y("span"),n=U(e),this.h()},l(a){t=$(a,"SPAN",{class:!0});var i=T(t);n=F(i,e),i.forEach(b),this.h()},h(){I(t,"class","ml-2 text-sm badge rounded-sm px-2 bg-green-500 text-white svelte-bvxti")},m(a,i){X(a,t,i),c(t,n)},p(a,i){i[0]&16384&&e!==(e=a[14]("course.navItem.submissions.grading_modal.early")+"")&&re(n,e)},d(a){a&&b(t)}}}function es(s){let t,e;return t=new Lt({props:{text:s[14]("delete_modal.label"),danger:!0}}),t.$on("click",s[28]),{c(){Y(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,a){Z(t,n,a),e=!0},p(n,a){const i={};a[0]&16384&&(i.text=n[14]("delete_modal.label")),t.$set(i)},i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){R(t.$$.fragment,n),e=!1},d(n){x(t,n)}}}function ts(s){let t,e,n;return{c(){t=U(s[9]),e=U("/"),n=U(s[10])},l(a){t=F(a,s[9]),e=F(a,"/"),n=F(a,s[10])},m(a,i){X(a,t,i),X(a,e,i),X(a,n,i)},p(a,i){i[0]&512&&re(t,a[9]),i[0]&1024&&re(n,a[10])},d(a){a&&(b(t),b(e),b(n))}}}function it(s){let t,e,n,a,i,o=s[0].student.fullname+"",r;return{c(){t=y("div"),e=y("img"),a=N(),i=y("p"),r=U(o),this.h()},l(l){t=$(l,"DIV",{class:!0});var u=T(t);e=$(u,"IMG",{alt:!0,class:!0,src:!0}),a=O(u),i=$(u,"P",{class:!0});var f=T(i);r=F(f,o),f.forEach(b),u.forEach(b),this.h()},h(){I(e,"alt","Student avatar"),I(e,"class","flex rounded-full h-5 w-5"),Ge(e.src,n=s[0].student.avatar_url)||I(e,"src",n),I(i,"class","dark:text-white font-semibold ml-2 text-sm line-clamp-1"),I(t,"class","flex flex-row justify-center items-center bg-gray-100 dark:bg-neutral-700 rounded-md p-[6px]")},m(l,u){X(l,t,u),c(t,e),c(t,a),c(t,i),c(i,r)},p(l,u){u[0]&1&&!Ge(e.src,n=l[0].student.avatar_url)&&I(e,"src",n),u[0]&1&&o!==(o=l[0].student.fullname+"")&&re(r,o)},d(l){l&&b(t)}}}function ss(s){let t,e,n,a,i=s[14]("course.navItem.submissions.grading_modal.grade_with_ai")+"",o;return{c(){t=y("img"),n=N(),a=y("p"),o=U(i),this.h()},l(r){t=$(r,"IMG",{src:!0,alt:!0}),n=O(r),a=$(r,"P",{class:!0});var l=T(a);o=F(l,i),l.forEach(b),this.h()},h(){Ge(t.src,e="/ai.svg")||I(t,"src",e),I(t,"alt","ai"),I(a,"class","font-semibold text-sm")},m(r,l){X(r,t,l),X(r,n,l),X(r,a,l),c(a,o)},p(r,l){l[0]&16384&&i!==(i=r[14]("course.navItem.submissions.grading_modal.grade_with_ai")+"")&&re(o,i)},d(r){r&&(b(t),b(n),b(a))}}}function ns(s){let t,e,n,a,i,o,r,l,u=s[14]("course.navItem.submissions.grading_modal.details")+"",f,m,_,d,v,S,G,E=s[14]("course.navItem.submissions.grading_modal.total_grade")+"",W,B,k,V,J,ee,se,ne=s[14]("course.navItem.submissions.grading_modal.student")+"",fe,me,_e,pe,ae,z,q=s[14]("course.navItem.submissions.grading_modal.status")+"",g,C,A,P,w,H,j,ie,p=s[14]("course.navItem.submissions.grading_modal.add_comment")+"",M,oe,Q,de,ke,qe,te,ce,Ce,ye,Ie;const xe=[Kt,Yt],$e=[];function et(h,D){return h[12]?0:1}e=et(s),n=$e[e]=xe[e](s);function tt(h,D){return h[0].isEarly?xt:Zt}let Oe=tt(s),ge=Oe(s);d=new Wt({props:{open:s[11],flipped:!0,$$slots:{default:[es]},$$scope:{ctx:s}}}),V=new Rt({props:{class:"dark:text-white font-semibold text-black bg-gray-100 dark:bg-neutral-700 rounded-md w-fit",$$slots:{default:[ts]},$$scope:{ctx:s}}});let le=s[0].student&&it(s);function It(h){s[29](h)}let st={items:s[15],class:"w-full"};s[6]!==void 0&&(st.selectedId=s[6]),P=new jt({props:st}),be.push(()=>he(P,"selectedId",It)),P.$on("select",s[16]);function wt(h){s[30](h)}let nt={bgColor:"bg-gray-100 dark:bg-neutral-700",className:"font-semibold",placeholder:s[14]("course.navItem.submissions.grading_modal.add_comment_placeholder")};return s[0].feedback!==void 0&&(nt.value=s[0].feedback),de=new Vt({props:nt}),be.push(()=>he(de,"value",wt)),ce=new Re({props:{onClick:s[20],variant:je.OUTLINED,className:"space-x-3 py-3 px-8 w-full ",$$slots:{default:[ss]},$$scope:{ctx:s}}}),ye=new Re({props:{onClick:s[31],isLoading:s[5],label:s[14]("course.navItem.submissions.grading_modal.submit_grades"),variant:je.CONTAINED,className:"py-3 px-8 w-full"}}),{c(){t=y("div"),n.c(),a=N(),i=y("div"),o=y("div"),r=y("div"),l=y("p"),f=U(u),m=N(),ge.c(),_=N(),Y(d.$$.fragment),v=N(),S=y("div"),G=y("p"),W=U(E),B=U(":"),k=N(),Y(V.$$.fragment),J=N(),ee=y("div"),se=y("p"),fe=U(ne),me=U(":"),_e=N(),le&&le.c(),pe=N(),ae=y("div"),z=y("p"),g=U(q),C=U(":"),A=N(),Y(P.$$.fragment),H=N(),j=y("div"),ie=y("p"),M=U(p),oe=U(":"),Q=N(),Y(de.$$.fragment),qe=N(),te=y("div"),Y(ce.$$.fragment),Ce=N(),Y(ye.$$.fragment),this.h()},l(h){t=$(h,"DIV",{class:!0});var D=T(t);n.l(D),D.forEach(b),a=O(h),i=$(h,"DIV",{class:!0});var De=T(i);o=$(De,"DIV",{class:!0});var ue=T(o);r=$(ue,"DIV",{class:!0});var Ae=T(r);l=$(Ae,"P",{class:!0});var Ee=T(l);f=F(Ee,u),m=O(Ee),ge.l(Ee),Ee.forEach(b),_=O(Ae),K(d.$$.fragment,Ae),Ae.forEach(b),v=O(ue),S=$(ue,"DIV",{class:!0});var Se=T(S);G=$(Se,"P",{class:!0});var Te=T(G);W=F(Te,E),B=F(Te,":"),Te.forEach(b),k=O(Se),K(V.$$.fragment,Se),Se.forEach(b),J=O(ue),ee=$(ue,"DIV",{class:!0});var we=T(ee);se=$(we,"P",{class:!0});var Fe=T(se);fe=F(Fe,ne),me=F(Fe,":"),Fe.forEach(b),_e=O(we),le&&le.l(we),we.forEach(b),pe=O(ue),ae=$(ue,"DIV",{class:!0});var Be=T(ae);z=$(Be,"P",{class:!0});var ze=T(z);g=F(ze,q),C=F(ze,":"),ze.forEach(b),A=O(Be),K(P.$$.fragment,Be),Be.forEach(b),H=O(ue),j=$(ue,"DIV",{class:!0});var Ve=T(j);ie=$(Ve,"P",{class:!0});var He=T(ie);M=F(He,p),oe=F(He,":"),He.forEach(b),Q=O(Ve),K(de.$$.fragment,Ve),Ve.forEach(b),qe=O(ue),te=$(ue,"DIV",{class:!0});var We=T(te);K(ce.$$.fragment,We),Ce=O(We),K(ye.$$.fragment,We),We.forEach(b),ue.forEach(b),De.forEach(b),this.h()},h(){I(t,"class","w-full h-full mt-2"),I(l,"class","dark:text-white font-bold text-base"),I(r,"class","flex gap-1 justify-between items-center border-b border-t-0 border-l-0 border-r-0 border-gray-300 p-3"),I(G,"class","dark:text-white text-sm text-gray-500 font-semibold"),I(S,"class","flex items-center space-x-4 text-sm px-3 py-2"),I(se,"class","dark:text-white text-sm text-gray-500 font-semibold"),I(ee,"class","flex items-center space-x-4 text-sm px-3 py-2"),I(z,"class","dark:text-white text-gray-500 font-semibold"),I(ae,"class","flex flex-col items-start text-sm px-3 py-2"),I(ie,"class","dark:text-white text-gray-500 font-semibold"),I(j,"class","flex flex-col items-start text-sm px-3 py-2"),I(te,"class","flex flex-col w-full space-y-3 px-3 py-2"),I(o,"class","border border-gray-300 rounded-md"),I(i,"class","ml-4 mt-2 w-2/5 sticky top-0")},m(h,D){X(h,t,D),$e[e].m(t,null),X(h,a,D),X(h,i,D),c(i,o),c(o,r),c(r,l),c(l,f),c(l,m),ge.m(l,null),c(r,_),Z(d,r,null),c(o,v),c(o,S),c(S,G),c(G,W),c(G,B),c(S,k),Z(V,S,null),c(o,J),c(o,ee),c(ee,se),c(se,fe),c(se,me),c(ee,_e),le&&le.m(ee,null),c(o,pe),c(o,ae),c(ae,z),c(z,g),c(z,C),c(ae,A),Z(P,ae,null),c(o,H),c(o,j),c(j,ie),c(ie,M),c(ie,oe),c(j,Q),Z(de,j,null),c(o,qe),c(o,te),Z(ce,te,null),c(te,Ce),Z(ye,te,null),Ie=!0},p(h,D){let De=e;e=et(h),e===De?$e[e].p(h,D):(Ke(),R($e[De],1,1,()=>{$e[De]=null}),Ze(),n=$e[e],n?n.p(h,D):(n=$e[e]=xe[e](h),n.c()),L(n,1),n.m(t,null)),(!Ie||D[0]&16384)&&u!==(u=h[14]("course.navItem.submissions.grading_modal.details")+"")&&re(f,u),Oe===(Oe=tt(h))&&ge?ge.p(h,D):(ge.d(1),ge=Oe(h),ge&&(ge.c(),ge.m(l,null)));const ue={};D[0]&2048&&(ue.open=h[11]),D[0]&22528|D[1]&128&&(ue.$$scope={dirty:D,ctx:h}),d.$set(ue),(!Ie||D[0]&16384)&&E!==(E=h[14]("course.navItem.submissions.grading_modal.total_grade")+"")&&re(W,E);const Ae={};D[0]&1536|D[1]&128&&(Ae.$$scope={dirty:D,ctx:h}),V.$set(Ae),(!Ie||D[0]&16384)&&ne!==(ne=h[14]("course.navItem.submissions.grading_modal.student")+"")&&re(fe,ne),h[0].student?le?le.p(h,D):(le=it(h),le.c(),le.m(ee,null)):le&&(le.d(1),le=null),(!Ie||D[0]&16384)&&q!==(q=h[14]("course.navItem.submissions.grading_modal.status")+"")&&re(g,q);const Ee={};!w&&D[0]&64&&(w=!0,Ee.selectedId=h[6],ve(()=>w=!1)),P.$set(Ee),(!Ie||D[0]&16384)&&p!==(p=h[14]("course.navItem.submissions.grading_modal.add_comment")+"")&&re(M,p);const Se={};D[0]&16384&&(Se.placeholder=h[14]("course.navItem.submissions.grading_modal.add_comment_placeholder")),!ke&&D[0]&1&&(ke=!0,Se.value=h[0].feedback,ve(()=>ke=!1)),de.$set(Se);const Te={};D[0]&16384|D[1]&128&&(Te.$$scope={dirty:D,ctx:h}),ce.$set(Te);const we={};D[0]&17&&(we.onClick=h[31]),D[0]&32&&(we.isLoading=h[5]),D[0]&16384&&(we.label=h[14]("course.navItem.submissions.grading_modal.submit_grades")),ye.$set(we)},i(h){Ie||(L(n),L(d.$$.fragment,h),L(V.$$.fragment,h),L(P.$$.fragment,h),L(de.$$.fragment,h),L(ce.$$.fragment,h),L(ye.$$.fragment,h),Ie=!0)},o(h){R(n),R(d.$$.fragment,h),R(V.$$.fragment,h),R(P.$$.fragment,h),R(de.$$.fragment,h),R(ce.$$.fragment,h),R(ye.$$.fragment,h),Ie=!1},d(h){h&&(b(t),b(a),b(i)),$e[e].d(),ge.d(),x(d),x(V),le&&le.d(),x(P),x(de),x(ce),x(ye)}}}function rs(s){let t,e,n;function a(o){s[32](o)}let i={modalHeading:s[0].title,onClose:s[3],width:"w-4/5 h-[90%]",containerClass:"flex items-start !max-h-full h-[85%] py-0 px-4",headerClass:"py-2",labelClass:"text-base font-semibold",$$slots:{default:[ns]},$$scope:{ctx:s}};return s[1]!==void 0&&(i.open=s[1]),t=new Ct({props:i}),be.push(()=>he(t,"open",a)),{c(){Y(t.$$.fragment)},l(o){K(t.$$.fragment,o)},m(o,r){Z(t,o,r),n=!0},p(o,r){const l={};r[0]&1&&(l.modalHeading=o[0].title),r[0]&8&&(l.onClose=o[3]),r[0]&32757|r[1]&128&&(l.$$scope={dirty:r,ctx:o}),!e&&r[0]&2&&(e=!0,l.open=o[1],ve(()=>e=!1)),t.$set(l)},i(o){n||(L(t.$$.fragment,o),n=!0)},o(o){R(t.$$.fragment,o),n=!1},d(o){x(t,o)}}}function as(s){return(s||[]).reduce((t,e)=>t+e.points,0)}function is(s){return s?Object.values(s).reduce((t,e)=>t+parseInt(e||"0"),0):0}const ot=(s,t)=>s.order-t.order;function os(s,t,e){let n,a,i;Pe(s,vt,p=>e(14,a=p));let{open:o=!1}=t,{onClose:r=()=>{}}=t,{handleSave:l=p=>{}}=t,{isGradeWithAI:u=!1}=t,{data:f}=t,{deleteSubmission:m=async(p,M)=>{}}=t,{updateStatus:_=p=>{}}=t,{isSaving:d=!1}=t;const v=[{id:Qe.SUBMITTED,text:a("course.navItem.submissions.submission_status.submitted")},{id:Qe.IN_PROGRESS,text:a("course.navItem.submissions.submission_status.in_progress")},{id:Qe.GRADED,text:a("course.navItem.submissions.submission_status.graded")}];let S=v[0],G=S.id,E={},W=!1,B=0,k=0,V=!1,J=!1,ee=!1;function se(p){const M=p.detail.selectedId;ne({...f,statusId:M}),_({submissionId:f.id,prevStatusId:f.statusId,nextStatusId:S.id,total:B}),Me.success(`${a("snackbar.exercise.submission_updated")} '${S.text}'`)}function ne(p){const M=v.find(oe=>oe.id===p.statusId);M&&(S=M,p.statusId!==G&&e(6,G=p.statusId))}async function fe(){e(13,ee=!0),await m(f.id,S.id),e(13,ee=!1)}const{input:me,handleSubmit:_e,completion:pe}=Bt({api:"/api/completion/gradingprompt",onFinish:async()=>{try{const p=i.replace("```json","").replace("```","");let M=[];try{M=JSON.parse(p)}catch(oe){console.error("Error parsing AI response",oe)}f==null||f.questions.forEach(oe=>{var qe;const{id:Q,points:de,question_type_id:ke}=oe;if(ke!==at.TEXTAREA){const te=f.questionAnswers.find(Ce=>Ce.question_id===Q),ce=((qe=te==null?void 0:te.answers)==null?void 0:qe.length)??0;e(7,E={...E,[Q]:`${a("course.navItem.submissions.grading_modal.questions_tried")} ${ce} `}),e(0,f.questionAnswerByPoint[Q]=`${Math.ceil(de/ce)}`,f)}else if(M.length){const te=M.find(ce=>ce.id===Q);e(7,E={...E,[Q]:`${te==null?void 0:te.explanation}`}),e(0,f.questionAnswerByPoint[Q]=`${te==null?void 0:te.score}`,f)}})}catch(p){console.error("Error",p)}finally{e(8,W=!1)}}});Pe(s,me,p=>e(34,n=p)),Pe(s,pe,p=>e(35,i=p));function ae(){e(2,u=!0),e(8,W=!0);const p=f.questions.filter(M=>M.question_type_id===at.TEXTAREA).map(M=>{const oe=f.questionAnswers.find(Q=>Q.question_id===M.id);return{id:M.id,question:M.title,answer:oe==null?void 0:oe.open_answer,point:M.points}});yt(me,n=JSON.stringify(p),n),_e({preventDefault:()=>{}})}const z=()=>e(12,J=!1);function q(p){s.$$.not_equal(f.questionAnswerByPoint,p)&&(f.questionAnswerByPoint=p,e(0,f))}function g(p){E=p,e(7,E)}function C(p){u=p,e(2,u)}function A(p){W=p,e(8,W)}const P=()=>{e(12,J=!0),e(11,V=!1)};function w(p){G=p,e(6,G)}function H(p){s.$$.not_equal(f.feedback,p)&&(f.feedback=p,e(0,f))}const j=()=>{l(f)};function ie(p){o=p,e(1,o)}return s.$$set=p=>{"open"in p&&e(1,o=p.open),"onClose"in p&&e(3,r=p.onClose),"handleSave"in p&&e(4,l=p.handleSave),"isGradeWithAI"in p&&e(2,u=p.isGradeWithAI),"data"in p&&e(0,f=p.data),"deleteSubmission"in p&&e(21,m=p.deleteSubmission),"updateStatus"in p&&e(22,_=p.updateStatus),"isSaving"in p&&e(5,d=p.isSaving)},s.$$.update=()=>{s.$$.dirty[0]&1&&e(9,B=is(f.questionAnswerByPoint)),s.$$.dirty[0]&1&&e(10,k=as(f.questions)),s.$$.dirty[0]&1&&ne(f)},[f,o,u,r,l,d,G,E,W,B,k,V,J,ee,a,v,se,fe,me,pe,ae,m,_,z,q,g,C,A,P,w,H,j,ie]}class ls extends mt{constructor(t){super(),ct(this,t,os,rs,ht,{open:1,onClose:3,handleSave:4,isGradeWithAI:2,data:0,deleteSubmission:21,updateStatus:22,isSaving:5},null,[-1,-1])}}const us=(s,t)=>t?new Date(s).getTime()<=new Date(t).getTime():!0,ds=s=>{const t=new Date(s);return new Intl.DateTimeFormat("en",{year:"numeric"}).format(t),new Intl.DateTimeFormat("en",{month:"2-digit"}).format(t),new Intl.DateTimeFormat("en",{day:"2-digit"}).format(t),new Intl.DateTimeFormat("en-US",{dateStyle:"full",timeStyle:"medium"}).format(t)};function lt(s,t,e){const n=s.slice();return n[30]=t[e].id,n[31]=t[e].title,n[32]=t[e].items,n[34]=e,n}function ut(s,t,e){const n=s.slice();return n[35]=t[e],n}function fs(s){let t,e=[],n=new Map,a,i,o,r=Le(s[32]);const l=u=>u[35].id;for(let u=0;u<r.length;u+=1){let f=ut(s,r,u),m=l(f);n.set(m,e[u]=dt(m,f))}return{c(){t=y("div");for(let u=0;u<e.length;u+=1)e[u].c();this.h()},l(u){t=$(u,"DIV",{class:!0});var f=T(t);for(let m=0;m<e.length;m+=1)e[m].l(f);f.forEach(b),this.h()},h(){I(t,"class","content pr-2 overflow-y-auto mb-3 svelte-1j77sks")},m(u,f){X(u,t,f);for(let m=0;m<e.length;m+=1)e[m]&&e[m].m(t,null);i||(o=[$t(a=kt.call(null,t,{items:s[32],flipDurationMs:Ue,dropTargetStyle:{outline:"blue"}})),rt(t,"consider",function(){Je(s[10](s[34]))&&s[10](s[34]).apply(this,arguments)}),rt(t,"finalize",function(){Je(s[11](s[34]))&&s[11](s[34]).apply(this,arguments)})],i=!0)},p(u,f){if(s=u,f[0]&264){r=Le(s[32]);for(let m=0;m<e.length;m+=1)e[m].r();e=bt(e,f,l,1,s,r,n,t,Et,dt,null,ut);for(let m=0;m<e.length;m+=1)e[m].a()}a&&Je(a.update)&&f[0]&256&&a.update.call(null,{items:s[32],flipDurationMs:Ue,dropTargetStyle:{outline:"blue"}})},i:Ne,o:Ne,d(u){u&&b(t);for(let f=0;f<e.length;f+=1)e[f].d();i=!1,St(o)}}}function ms(s){let t,e,n,a,i,o;return t=new Ye({props:{style:"width: 100%; height: 170px;",class:"rounded-md my-2"}}),n=new Ye({props:{style:"width: 100%; height: 170px;",class:"rounded-md my-2"}}),i=new Ye({props:{style:"width: 100%; height: 170px;",class:"rounded-md my-2"}}),{c(){Y(t.$$.fragment),e=N(),Y(n.$$.fragment),a=N(),Y(i.$$.fragment)},l(r){K(t.$$.fragment,r),e=O(r),K(n.$$.fragment,r),a=O(r),K(i.$$.fragment,r)},m(r,l){Z(t,r,l),X(r,e,l),Z(n,r,l),X(r,a,l),Z(i,r,l),o=!0},p:Ne,i(r){o||(L(t.$$.fragment,r),L(n.$$.fragment,r),L(i.$$.fragment,r),o=!0)},o(r){R(t.$$.fragment,r),R(n.$$.fragment,r),R(i.$$.fragment,r),o=!1},d(r){r&&(b(e),b(a)),x(t,r),x(n,r),x(i,r)}}}function dt(s,t){let e,n,a,i,o,r,l=t[35].student.username+"",u,f,m,_,d=t[35].exercise.title+"",v,S,G,E,W,B,k=t[35].lesson.title+"",V,J,ee,se,ne=t[35].submittedAt+"",fe,me,_e,pe,ae=Ne;return{key:s,first:null,c(){e=y("div"),n=y("a"),a=y("img"),o=N(),r=y("p"),u=U(l),m=N(),_=y("a"),v=U(d),G=N(),E=y("a"),W=y("p"),B=U("#"),V=U(k),ee=N(),se=y("p"),fe=U(ne),me=N(),this.h()},l(z){e=$(z,"DIV",{class:!0});var q=T(e);n=$(q,"A",{class:!0,href:!0});var g=T(n);a=$(g,"IMG",{alt:!0,class:!0,src:!0}),o=O(g),r=$(g,"P",{class:!0});var C=T(r);u=F(C,l),C.forEach(b),g.forEach(b),m=O(q),_=$(q,"A",{class:!0,href:!0});var A=T(_);v=F(A,d),A.forEach(b),G=O(q),E=$(q,"A",{class:!0,href:!0});var P=T(E);W=$(P,"P",{class:!0});var w=T(W);B=F(w,"#"),V=F(w,k),w.forEach(b),P.forEach(b),ee=O(q),se=$(q,"P",{class:!0});var H=T(se);fe=F(H,ne),H.forEach(b),me=O(q),q.forEach(b),this.h()},h(){var z,q;I(a,"alt","Student avatar"),I(a,"class","block rounded-full h-6 w-6"),Ge(a.src,i=t[35].student.avatar_url)||I(a,"src",i),I(r,"class","dark:text-white ml-2 text-sm"),I(n,"class","flex w-full items-center cursor-pointer text-black mb-2"),I(n,"href",f=`${t[3].url.pathname}?submissionId=${t[35].id}`),I(_,"class","text-primary-700 text-md font-bold"),I(_,"href",S=t[3].url.pathname+"?submissionId="+t[35].id),I(W,"class","dark:text-white text-grey text-sm"),I(E,"class","flex items-center no-underline hover:underline text-black my-2"),I(E,"href",J=((q=(z=t[3].url)==null?void 0:z.pathname)==null?void 0:q.replace("submissions","lessons"))+"/"+t[35].lesson.id+"/exercises/"+t[35].exercise.id),I(se,"class","dark:text-white text-gray-500 text-xs"),I(e,"class",_e=(t[35].isEarly?"border-none":"border border-red-700")+" w-full my-2 mx-0 rounded-md bg-white dark:bg-neutral-800 py-3 px-3"),this.first=e},m(z,q){X(z,e,q),c(e,n),c(n,a),c(n,o),c(n,r),c(r,u),c(e,m),c(e,_),c(_,v),c(e,G),c(e,E),c(E,W),c(W,B),c(W,V),c(e,ee),c(e,se),c(se,fe),c(e,me)},p(z,q){var g,C;t=z,q[0]&256&&!Ge(a.src,i=t[35].student.avatar_url)&&I(a,"src",i),q[0]&256&&l!==(l=t[35].student.username+"")&&re(u,l),q[0]&264&&f!==(f=`${t[3].url.pathname}?submissionId=${t[35].id}`)&&I(n,"href",f),q[0]&256&&d!==(d=t[35].exercise.title+"")&&re(v,d),q[0]&264&&S!==(S=t[3].url.pathname+"?submissionId="+t[35].id)&&I(_,"href",S),q[0]&256&&k!==(k=t[35].lesson.title+"")&&re(V,k),q[0]&264&&J!==(J=((C=(g=t[3].url)==null?void 0:g.pathname)==null?void 0:C.replace("submissions","lessons"))+"/"+t[35].lesson.id+"/exercises/"+t[35].exercise.id)&&I(E,"href",J),q[0]&256&&ne!==(ne=t[35].submittedAt+"")&&re(fe,ne),q[0]&256&&_e!==(_e=(t[35].isEarly?"border-none":"border border-red-700")+" w-full my-2 mx-0 rounded-md bg-white dark:bg-neutral-800 py-3 px-3")&&I(e,"class",_e)},r(){pe=e.getBoundingClientRect()},f(){_t(e),ae()},a(){ae(),ae=pt(e,pe,gt,{duration:Ue})},d(z){z&&b(e)}}}function ft(s,t){let e,n,a,i,o,r=t[31]+"",l,u,f,m,_,d,v=Ne,S;a=new Ut({props:{value:t[32].length,className:"bg-set dark:bg-neutral-800"}});const G=[ms,fs],E=[];function W(B,k){return B[6]?0:1}return f=W(t),m=E[f]=G[f](t),{key:s,first:null,c(){e=y("div"),n=y("div"),Y(a.$$.fragment),i=N(),o=y("p"),l=U(r),u=N(),m.c(),_=N(),this.h()},l(B){e=$(B,"DIV",{class:!0});var k=T(e);n=$(k,"DIV",{class:!0});var V=T(n);K(a.$$.fragment,V),i=O(V),o=$(V,"P",{class:!0});var J=T(o);l=F(J,r),J.forEach(b),V.forEach(b),u=O(k),m.l(k),_=O(k),k.forEach(b),this.h()},h(){I(o,"class","dark:text-white ml-2 font-bold"),I(n,"class","flex items-center mb-2"),I(e,"class","section rounded-md bg-gray-100 dark:bg-black border border-gray-50 dark:border-neutral-600 p-3 h-80 mr-3 overflow-hidden svelte-1j77sks"),this.first=e},m(B,k){X(B,e,k),c(e,n),Z(a,n,null),c(n,i),c(n,o),c(o,l),c(e,u),E[f].m(e,null),c(e,_),S=!0},p(B,k){t=B;const V={};k[0]&256&&(V.value=t[32].length),a.$set(V),(!S||k[0]&256)&&r!==(r=t[31]+"")&&re(l,r);let J=f;f=W(t),f===J?E[f].p(t,k):(Ke(),R(E[J],1,1,()=>{E[J]=null}),Ze(),m=E[f],m?m.p(t,k):(m=E[f]=G[f](t),m.c()),L(m,1),m.m(e,_))},r(){d=e.getBoundingClientRect()},f(){_t(e),v()},a(){v(),v=pt(e,d,gt,{duration:Ue})},i(B){S||(L(a.$$.fragment,B),L(m),S=!0)},o(B){R(a.$$.fragment,B),R(m),S=!1},d(B){B&&b(e),x(a),E[f].d()}}}function cs(s){let t,e=[],n=new Map,a,i=Le(s[8]);const o=r=>r[30];for(let r=0;r<i.length;r+=1){let l=lt(s,i,r),u=o(l);n.set(u,e[r]=ft(u,l))}return{c(){t=y("div");for(let r=0;r<e.length;r+=1)e[r].c();this.h()},l(r){t=$(r,"DIV",{class:!0});var l=T(t);for(let u=0;u<e.length;u+=1)e[u].l(l);l.forEach(b),this.h()},h(){I(t,"class","flex items-center w-full")},m(r,l){X(r,t,l);for(let u=0;u<e.length;u+=1)e[u]&&e[u].m(t,null);a=!0},p(r,l){if(l[0]&3400){i=Le(r[8]),Ke();for(let u=0;u<e.length;u+=1)e[u].r();e=bt(e,l,o,1,r,i,n,t,At,ft,null,lt);for(let u=0;u<e.length;u+=1)e[u].a();Ze()}},i(r){if(!a){for(let l=0;l<i.length;l+=1)L(e[l]);a=!0}},o(r){for(let l=0;l<e.length;l+=1)R(e[l]);a=!1},d(r){r&&b(t);for(let l=0;l<e.length;l+=1)e[l].d()}}}function _s(s){let t,e,n,a;return t=new Dt({props:{title:s[9]("course.navItem.submissions.title")}}),n=new zt({props:{width:"w-full max-w-6xl md:w-11/12 overflow-x-auto",$$slots:{default:[cs]},$$scope:{ctx:s}}}),{c(){Y(t.$$.fragment),e=N(),Y(n.$$.fragment)},l(i){K(t.$$.fragment,i),e=O(i),K(n.$$.fragment,i)},m(i,o){Z(t,i,o),X(i,e,o),Z(n,i,o),a=!0},p(i,o){const r={};o[0]&512&&(r.title=i[9]("course.navItem.submissions.title")),t.$set(r);const l={};o[0]&328|o[1]&128&&(l.$$scope={dirty:o,ctx:i}),n.$set(l)},i(i){a||(L(t.$$.fragment,i),L(n.$$.fragment,i),a=!0)},o(i){R(t.$$.fragment,i),R(n.$$.fragment,i),a=!1},d(i){i&&b(e),x(t,i),x(n,i)}}}function ps(s){let t,e;return t=new Tt({props:{allowedRoles:[1,2],$$slots:{default:[_s]},$$scope:{ctx:s}}}),{c(){Y(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,a){Z(t,n,a),e=!0},p(n,a){const i={};a[0]&840|a[1]&128&&(i.$$scope={dirty:a,ctx:n}),t.$set(i)},i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){R(t.$$.fragment,n),e=!1},d(n){x(t,n)}}}function gs(s){let t,e,n,a,i,o,r;function l(d){s[17](d)}function u(d){s[18](d)}let f={onClose:s[12],data:s[1][s[2]]||{},handleSave:s[15],updateStatus:s[13],deleteSubmission:s[14],isSaving:s[7]};s[4]!==void 0&&(f.open=s[4]),s[5]!==void 0&&(f.isGradeWithAI=s[5]),t=new ls({props:f}),be.push(()=>he(t,"open",l)),be.push(()=>he(t,"isGradeWithAI",u));function m(d){s[19](d)}let _={$$slots:{default:[ps]},$$scope:{ctx:s}};return s[0].courseId!==void 0&&(_.courseId=s[0].courseId),i=new Ft({props:_}),be.push(()=>he(i,"courseId",m)),{c(){Y(t.$$.fragment),a=N(),Y(i.$$.fragment)},l(d){K(t.$$.fragment,d),a=O(d),K(i.$$.fragment,d)},m(d,v){Z(t,d,v),X(d,a,v),Z(i,d,v),r=!0},p(d,v){const S={};v[0]&6&&(S.data=d[1][d[2]]||{}),v[0]&128&&(S.isSaving=d[7]),!e&&v[0]&16&&(e=!0,S.open=d[4],ve(()=>e=!1)),!n&&v[0]&32&&(n=!0,S.isGradeWithAI=d[5],ve(()=>n=!1)),t.$set(S);const G={};v[0]&840|v[1]&128&&(G.$$scope={dirty:v,ctx:d}),!o&&v[0]&1&&(o=!0,G.courseId=d[0].courseId,ve(()=>o=!1)),i.$set(G)},i(d){r||(L(t.$$.fragment,d),L(i.$$.fragment,d),r=!0)},o(d){R(t.$$.fragment,d),R(i.$$.fragment,d),r=!1},d(d){d&&b(a),x(t,d),x(i,d)}}}const Ue=300;function hs(s){return(s||[]).reduce((t,e)=>t+e.points,0)}function bs(s){return s?Object.values(s).reduce((t,e)=>t+parseInt(e),0):0}function vs(s,t,e){let n,a,i,o;Pe(s,qt,g=>e(3,n=g)),Pe(s,Ht,g=>e(16,a=g)),Pe(s,Qt,g=>e(24,i=g)),Pe(s,vt,g=>e(9,o=g));let{data:r}=t;const{courseId:l}=r;let u,f,m=0,_=0,d={},v,S=!1,G=!1,E=!1,W=!1;const B={1:o("course.navItem.submissions.submission_status.submitted"),2:o("course.navItem.submissions.submission_status.in_progress"),3:o("course.navItem.submissions.submission_status.graded")};let k=[{id:1,title:o("course.navItem.submissions.submission_status.submitted"),value:0,items:[]},{id:2,title:o("course.navItem.submissions.submission_status.in_progress"),value:0,items:[]},{id:3,title:o("course.navItem.submissions.submission_status.graded"),value:10,items:[]}];const V=g=>{_=hs(g==null?void 0:g.questions),m=bs(g==null?void 0:g.questionAnswerByPoint);const{fullname:C,email:A}=g==null?void 0:g.student,{title:P,statusId:w}=g,H=`${i}/courses/${l}/lessons/${f.id}/exercises/${u.id}`;`${C}${P}${B[w]}`,w==3?`${m}${_}${H}`:`${H}`,`${f.title}${a.title}`};function J(g,C){let A;const{id:P}=k[g];e(8,k[g].items=C.map(w=>(w.statusId!==P&&(A=w,w.statusId=P),w)),k),A&&(e(1,d[A.id]={...d[A.id],statusId:A.statusId},d),V(d[A.id]),Xe({id:A.id,status_id:A.statusId}).then(w=>console.log("Updated submission",w)))}function ee(g){return function(C){e(8,k[g].items=C.detail.items,k)}}function se(g){return C=>J(g,C.detail.items)}function ne(){e(5,G=!1),Pt(n.url.pathname)}function fe({submissionId:g,prevStatusId:C,nextStatusId:A,total:P}){let w;const{items:H}=k[C-1];e(8,k[C-1].items=H==null?void 0:H.filter(j=>j.id===g?(w=Object.assign(j),w&&(w.statusId=A),!1):!0),k),w&&e(8,k[A-1].items=[...k[A-1].items,w],k),w&&(e(1,d[w.id]={...d[w.id],statusId:w.statusId},d),V(d[w.id]),Xe({id:w.id,status_id:w.statusId,total:P}).then(j=>console.log("Updated submission",j)))}async function me(g,C){const{items:A}=k[C-1];e(8,k[C-1].items=A==null?void 0:A.filter(w=>w.id!==g),k),e(1,d[g]=void 0,d);const{error:P}=await Gt(g);if(P){console.error("Error deleting submission",P),Me.error("course.navItem.submissions.grading_modal.delete_error");return}Me.success("course.navItem.submissions.grading_modal.delete_success"),ne()}async function _e(g){e(7,W=!0);const{questionAnswerByPoint:C,questionAnswers:A,feedback:P}=g;let w=0;for(const H in C)if(Object.prototype.hasOwnProperty.call(C,H)){const j=A.find(M=>M.question_id==H),ie=C[H];w+=parseInt(ie,10);const p=await Nt({point:ie},{id:j==null?void 0:j.id});if(p.error){console.error("Error saving",p.error),Me.error("snackbar.something");return}}await Xe({id:v,total:w,feedback:P}),Me.success("snackbar.submissions.success.grading"),e(7,W=!1)}async function pe(g){e(6,E=!0);const{data:C}=await Ot(g),A={};if(C)for(const P of C){const{id:w,created_at:H,answers:j,groupmember:ie,feedback:p,exercise:M}=P,oe=us(H,M.due_by),Q={id:w,statusId:P.status_id,isEarly:oe,feedback:p,submittedAt:ds(H),exercise:{id:M.id,title:M.title},answers:j,student:ie&&ie.profile?ie.profile:{},lesson:{id:M.lesson.id,title:M.lesson.title}};u={id:Q.exercise.id,title:Q.exercise.title},f={id:Q.lesson.id,title:Q.lesson.title},e(1,d[w]={id:w,statusId:Q.statusId,feedback:p,isEarly:oe,title:M.title,student:Q.student,questions:M.questions,answers:Jt({questions:M.questions,answers:j}),questionAnswers:j,questionAnswerByPoint:j.reduce((de,ke)=>(de[ke.question_id]=ke.point,de),{})},d),Array.isArray(A[P.status_id])?A[P.status_id].push(Q):A[P.status_id]=[Q]}e(8,k=k.map((P,w)=>({...P,value:Array.isArray(A[w+1])?A[w+1].length:0,items:Array.isArray(A[w+1])?A[w+1]:[]}))),e(6,E=!1)}function ae(g){S=g,e(4,S),e(3,n),e(2,v),e(1,d)}function z(g){G=g,e(5,G)}function q(g){s.$$.not_equal(r.courseId,g)&&(r.courseId=g,e(0,r))}return s.$$set=g=>{"data"in g&&e(0,r=g.data)},s.$$.update=()=>{if(s.$$.dirty[0]&65536&&a.id&&pe(a.id),s.$$.dirty[0]&14){const g=new URLSearchParams(n.url.search);e(2,v=g.get("submissionId")??""),e(4,S=!!v&&d[v])}},[r,d,v,n,S,G,E,W,k,o,ee,se,ne,fe,me,_e,a,ae,z,q]}class Hs extends mt{constructor(t){super(),ct(this,t,vs,gs,ht,{data:0},null,[-1,-1])}}export{Hs as component,zs as universal};
//# sourceMappingURL=19.b1dfdccf.js.map
