import{s as z,w as B,x as k,y as K,d as _,z as I,i as D,A as V,p as O,B as G,C as v,t as P,D as $,b as E,l as S,e as R,f as w,m as C}from"../chunks/scheduler.ee52cacd.js";import{S as N,i as F,f as Q,b as j,d as A,m as H,t as J,a as M,e as U}from"../chunks/index.a2391391.js";import{g as T}from"../chunks/navigation.4bf4851d.js";import{P as W}from"../chunks/index.550ce75a.js";import{a as X}from"../chunks/supabase.2c784bff.js";import{A as Y}from"../chunks/index.817dabbc.js";import{R as q,h as Z}from"../chunks/org.1ee4885a.js";import{s as x}from"../chunks/theme.5ef85a9d.js";import{a as ee}from"../chunks/index.523fac41.js";import{p as te}from"../chunks/user.9ccdc884.js";import{s as re}from"../chunks/store.21c1b842.js";import{c as ae}from"../chunks/index.287abee1.js";import{p as oe}from"../chunks/stores.5de49fb7.js";(function(){try{var r=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},o=new Error().stack;o&&(r._sentryDebugIds=r._sentryDebugIds||{},r._sentryDebugIds[o]="ba45efbd-6340-4e3c-bd46-a8add370d98e",r._sentryDebugIdIdentifier="sentry-dbid-ba45efbd-6340-4e3c-bd46-a8add370d98e")}catch{}})();function ne(r){let o,s,a=r[0].name+"",c,i,m,d=r[0].description+"",t,u,f,p,e;return p=new W({props:{label:"Join Course",type:"submit",isDisabled:r[1],isLoading:r[1]}}),{c(){o=v("div"),s=v("h3"),c=P(a),i=k(),m=v("p"),t=P(d),u=k(),f=v("div"),j(p.$$.fragment),this.h()},l(n){o=$(n,"DIV",{class:!0});var l=E(o);s=$(l,"H3",{class:!0});var g=E(s);c=S(g,a),g.forEach(_),i=I(l),m=$(l,"P",{class:!0});var h=E(m);t=S(h,d),h.forEach(_),l.forEach(_),u=I(n),f=$(n,"DIV",{class:!0});var b=E(f);A(p.$$.fragment,b),b.forEach(_),this.h()},h(){R(s,"class","dark:text-white text-lg font-medium mt-0 mb-4 text-center"),R(m,"class","dark:text-white text-sm font-light text-center"),R(o,"class","mt-0 w-full"),R(f,"class","my-4 w-full flex justify-center items-center")},m(n,l){D(n,o,l),w(o,s),w(s,c),w(o,i),w(o,m),w(m,t),D(n,u,l),D(n,f,l),H(p,f,null),e=!0},p(n,l){(!e||l&1)&&a!==(a=n[0].name+"")&&C(c,a),(!e||l&1)&&d!==(d=n[0].description+"")&&C(t,d);const g={};l&2&&(g.isDisabled=n[1]),l&2&&(g.isLoading=n[1]),p.$set(g)},i(n){e||(J(p.$$.fragment,n),e=!0)},o(n){M(p.$$.fragment,n),e=!1},d(n){n&&(_(o),_(u),_(f)),U(p)}}}function se(r){let o,s,a,c,i;document.title=o="Join "+r[0].name+" on KinetsHub";function m(t){r[5](t)}let d={supabase:r[3],isLogin:!1,handleSubmit:r[4],isLoading:r[1],showOnlyContent:!0,showLogo:!0,$$slots:{default:[ne]},$$scope:{ctx:r}};return r[2]!==void 0&&(d.formRef=r[2]),a=new Y({props:d}),B.push(()=>Q(a,"formRef",m)),{c(){s=k(),j(a.$$.fragment)},l(t){K("svelte-1ucdzck",document.head).forEach(_),s=I(t),A(a.$$.fragment,t)},m(t,u){D(t,s,u),H(a,t,u),i=!0},p(t,[u]){(!i||u&1)&&o!==(o="Join "+t[0].name+" on KinetsHub")&&(document.title=o);const f={};u&2&&(f.isLoading=t[1]),u&515&&(f.$$scope={dirty:u,ctx:t}),!c&&u&4&&(c=!0,f.formRef=t[2],V(()=>c=!1)),a.$set(f)},i(t){i||(J(a.$$.fragment,t),i=!0)},o(t){M(a.$$.fragment,t),i=!1},d(t){t&&_(s),U(a,t)}}}function ie(r,o,s){let a,c;O(r,te,e=>s(6,a=e)),O(r,oe,e=>s(7,c=e));let{data:i}=o,m=X(),d=!1,t;async function u(){var h,b;if(s(1,d=!0),!a.id||!a.email)return console.log("Profile not found",a),T(`/signup?redirect=${((h=c.url)==null?void 0:h.pathname)||""}`);const{data:e,error:n}=await m.from("course").select("group_id").eq("id",i.id).single();if(console.log({courseData:e}),!(e!=null&&e.group_id)){console.error("error getting group",n);return}const l={profile_id:a.id,group_id:e.group_id,role_id:q.STUDENT};(b=(await m.from("groupmember").select("id, profile(email)").eq("group_id",e.group_id).eq("role_id",q.TUTOR).returns()).data)!=null&&b.map(y=>{var L;return((L=y.profile)==null?void 0:L.email)||""}),ee(l).then(y=>{if(s(1,d=!1),y.error){console.error("Error adding student to group",e.group_id,y.error),re.error("snackbar.invite.failed_join"),window.location.href="/lms";return}return ae("student_joined_course",{course_name:i.name,student_id:a.id,student_email:a.email}),T("/lms")})}function f(e){e&&Z.set(e)}G(async()=>{var e;x(((e=i.currentOrg)==null?void 0:e.theme)||"")});function p(e){t=e,s(2,t)}return r.$$set=e=>{"data"in e&&s(0,i=e.data)},r.$$.update=()=>{r.$$.dirty&1&&f(i.currentOrg)},[i,d,t,m,u,p]}class ve extends N{constructor(o){super(),F(this,o,ie,se,z,{data:0})}}export{ve as component};
//# sourceMappingURL=22.9ff674b2.js.map
