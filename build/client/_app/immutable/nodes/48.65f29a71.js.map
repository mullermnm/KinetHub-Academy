{"version":3,"file":"48.65f29a71.js","sources":["../../../../../../../../node_modules/.pnpm/carbon-icons-svelte@12.3.0/node_modules/carbon-icons-svelte/lib/Book.svelte","../../../../../../../../node_modules/.pnpm/carbon-icons-svelte@12.3.0/node_modules/carbon-icons-svelte/lib/UserAvatar.svelte","../../../../../../src/routes/profile/[id]/+page.js","../../../../../../src/routes/profile/[id]/+page.svelte"],"sourcesContent":["<script>\n  export let size = 16;\n\n  export let title = undefined;\n\n  $: labelled = $$props[\"aria-label\"] || $$props[\"aria-labelledby\"] || title;\n  $: attributes = {\n    \"aria-hidden\": labelled ? undefined : true,\n    role: labelled ? \"img\" : undefined,\n    focusable: Number($$props[\"tabindex\"]) === 0 ? true : undefined\n  };\n</script>\n\n<svg\n  xmlns=\"http://www.w3.org/2000/svg\"\n  viewBox=\"0 0 32 32\"\n  fill=\"currentColor\"\n  preserveAspectRatio=\"xMidYMid meet\"\n  width={size}\n  height={size}\n  {...attributes}\n  {...$$restProps}>\n  {#if title}<title>{title}</title>{/if}\n  <path d=\"M19 10H26V12H19zM19 15H26V17H19zM19 20H26V22H19zM6 10H13V12H6zM6 15H13V17H6zM6 20H13V22H6z\"></path><path d=\"M28,5H4A2.002,2.002,0,0,0,2,7V25a2.002,2.002,0,0,0,2,2H28a2.002,2.002,0,0,0,2-2V7A2.002,2.002,0,0,0,28,5ZM4,7H15V25H4ZM17,25V7H28V25Z\"></path>\n</svg>","<script>\n  export let size = 16;\n\n  export let title = undefined;\n\n  $: labelled = $$props[\"aria-label\"] || $$props[\"aria-labelledby\"] || title;\n  $: attributes = {\n    \"aria-hidden\": labelled ? undefined : true,\n    role: labelled ? \"img\" : undefined,\n    focusable: Number($$props[\"tabindex\"]) === 0 ? true : undefined\n  };\n</script>\n\n<svg\n  xmlns=\"http://www.w3.org/2000/svg\"\n  viewBox=\"0 0 32 32\"\n  fill=\"currentColor\"\n  preserveAspectRatio=\"xMidYMid meet\"\n  width={size}\n  height={size}\n  {...attributes}\n  {...$$restProps}>\n  {#if title}<title>{title}</title>{/if}\n  <path d=\"M16,8a5,5,0,1,0,5,5A5,5,0,0,0,16,8Zm0,8a3,3,0,1,1,3-3A3.0034,3.0034,0,0,1,16,16Z\"></path><path d=\"M16,2A14,14,0,1,0,30,16,14.0158,14.0158,0,0,0,16,2ZM10,26.3765V25a3.0033,3.0033,0,0,1,3-3h6a3.0033,3.0033,0,0,1,3,3v1.3765a11.8989,11.8989,0,0,1-12,0Zm13.9925-1.4507A5.0016,5.0016,0,0,0,19,20H13a5.0016,5.0016,0,0,0-4.9925,4.9258,12,12,0,1,1,15.985,0Z\"></path>\n</svg>","export const load = ({ params = { id: '' } }) => {\n  return {\n    profileId: params.id\n  };\n};\n","<script>\n  import UserAvatarIcon from 'carbon-icons-svelte/lib/UserAvatar.svelte';\n  import BookIcon from 'carbon-icons-svelte/lib/Book.svelte';\n  import TextField from '$lib/components/Form/TextField.svelte';\n  import PrimaryButton from '$lib/components/PrimaryButton/index.svelte';\n  import UploadImage from '$lib/components/UploadImage/index.svelte';\n  import { supabase } from '$lib/utils/functions/supabase';\n  import { user, profile } from '$lib/utils/store/user';\n\n  export let data;\n  const { profileId } = data;\n\n  let avatar;\n  let loading = false;\n  let currentProfile = {};\n  let isOwner = false;\n  let initialValueOfUserName, initialValueOfFullName, initialValueOfAvatar;\n\n  async function getProfile(profileId) {\n    loading = true;\n    // Get user profile\n\n    // Check if user has profile\n    let {\n      data: profileData,\n      error,\n      status\n    } = await supabase.from('profile').select(`*`).eq('id', profileId).single();\n\n    if (error && !profileData && status === 406 && $user.currentSession) {\n      // Not found\n    } else if (profileData) {\n      // Profile exists, go to profile page\n      currentProfile = profileData;\n      initialValueOfUserName = currentProfile.username;\n      initialValueOfFullName = currentProfile.fullname;\n    }\n\n    loading = false;\n  }\n\n  async function updateProfile() {\n    try {\n      loading = true;\n\n      const updates = {\n        fullname: currentProfile.fullname,\n        username: currentProfile.username\n      };\n\n      if (avatar) {\n        const filename = `user/${currentProfile.username + Date.now()}.webp`;\n\n        const { data } = await supabase.storage.from('avatars').upload(filename, avatar, {\n          cacheControl: '3600',\n          upsert: false\n        });\n\n        if (data) {\n          const { data: response } = supabase.storage.from('avatars').getPublicUrl(filename);\n\n          updates.avatar_url = response.publicUrl;\n          currentProfile.avatar_url = response.publicUrl;\n        }\n        avatar = undefined;\n      }\n\n      let { error } = await supabase.from('profile').update(updates).match({ id: profileId });\n\n      if (isOwner) {\n        profile.update((_profile) => ({\n          ..._profile,\n          ...updates\n        }));\n      }\n\n      if (error) throw error;\n    } catch (error) {\n      alert(error.message);\n      loading = false;\n    } finally {\n      loading = false;\n\n      initialValueOfUserName = currentProfile.username;\n      initialValueOfFullName = currentProfile.fullname;\n    }\n  }\n\n  $: isDirty =\n    avatar ||\n    initialValueOfUserName !== currentProfile.username ||\n    initialValueOfFullName !== currentProfile.fullname;\n  $: isOwner = $profile.id === profileId;\n  $: getProfile(profileId);\n\n  $: if (avatar) {\n    updateProfile();\n  }\n</script>\n\n<svelte:head>\n  <title>Profile of {currentProfile.username}</title>\n</svelte:head>\n\n<section class=\"root w-11/12 mt-3 m-auto flex items-start justify-between flex-col lg:flex-row\">\n  {#if currentProfile.id}\n    <div class=\"w-full lg:w-1/4 flex items-center flex-col\">\n      <!-- <img\n        alt={currentProfile.username}\n        src={currentProfile.avatar_url}\n        height=\"260\"\n        width=\"260\"\n        class=\"rounded-full bg-primary-100 mb-4\"\n      /> -->\n      <UploadImage bind:avatar src={currentProfile.avatar_url} widthHeight=\"w-60 h-60\" />\n\n      {#if isOwner}\n        <TextField\n          label=\"Full name\"\n          bind:value={currentProfile.fullname}\n          className=\"w-60 mb-4\"\n          inputClassName=\"rounded-md\"\n        />\n        <TextField\n          label=\"Username\"\n          bind:value={currentProfile.username}\n          className=\"w-60 mb-4\"\n          inputClassName=\"rounded-md\"\n        />\n        <TextField\n          label=\"Email\"\n          bind:value={currentProfile.email}\n          className=\"w-60 mb-4\"\n          inputClassName=\"rounded-md\"\n          isDisabled={true}\n        />\n\n        {#if isDirty}\n          <PrimaryButton\n            label={loading ? 'Updating...' : 'Update profile'}\n            onClick={updateProfile}\n            isDisabled={loading}\n          />\n        {/if}\n      {:else}\n        <h3 class=\"dark:text-white text-xl\">{currentProfile.username}</h3>\n      {/if}\n    </div>\n\n    <div class=\"flex-grow\" />\n    <div class=\"flex-grow flex flex-wrap mx-3 w-3/5\">\n      <div class=\"mb-3 w-full\">\n        <h3 class=\"dark:text-white font-bold text-md m-0\">Organizations</h3>\n        <p class=\"dark:text-white text-gray-500 text-sm\">This are the organizations you work at</p>\n\n        <div class=\"hidden my-3 py-3 px-4 border shadow-sm rounded-md\">\n          <h4 class=\"dark:text-white m-0 font-normal\">\n            <a class=\"text-primary-700 font-bold\" href=\"/courses\"> CitiBim </a>\n          </h4>\n          <p class=\"dark:text-white text-gray-500\">\n            Lorem ipsum dolor sit amet consectetur adipisicing elit. Non aliquam tenetur magnam.\n            Alias cumque quaerat expedita dolores placeat laboriosam culpa, suscipit veritatis\n            adipisci eius magni obcaecati. Sequi doloremque blanditiis earum.\n          </p>\n          <div class=\"mt-2 flex items-center\">\n            <span class=\"flex mr-2 items-center\">\n              <UserAvatarIcon size={16} class=\"mr-2\" /> 5\n            </span>\n\n            <span class=\"flex mr-2 items-center\">\n              <BookIcon size={16} class=\"mr-2\" /> 5\n            </span>\n          </div>\n        </div>\n\n        <div class=\"hidden my-2 py-3 px-4 border shadow-sm rounded-md\">\n          <h4 class=\"dark:text-white m-0 font-normal\">\n            <a class=\"text-primary-700 font-bold\" href=\"/courses\"> Climate Change Group </a>\n          </h4>\n          <p class=\"dark:text-white text-gray-500\">\n            Lorem ipsum dolor sit amet, consectetur adipisicing elit. Illo quasi autem quo possimus\n            illum consequuntur repudiandae nobis error, porro\n          </p>\n          <div class=\"mt-2 flex items-center\">\n            <span class=\"flex mr-2 items-center\">\n              <UserAvatarIcon size={16} class=\"mr-2\" /> 30\n            </span>\n\n            <span class=\"flex mr-2 items-center\">\n              <BookIcon size={16} class=\"mr-2\" /> 3\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <!-- {:else if loading}\n    <Box>\n      <Chasing size=\"60\" color=\"#ff3e00\" unit=\"px\" duration=\"1s\" />\n    </Box>\n  {:else}\n    <Box>\n      <div>\n        <Search32 />\n      </div>\n      <h3 class=\"dark:text-white text-xxl\">Profile not found</h3>\n    </Box> -->\n  {/if}\n</section>\n\n<style>\n  .root {\n    max-width: 1204px;\n  }\n</style>\n"],"names":["size","$$props","title","$$invalidate","attributes","labelled","load","params","ctx","dirty","uploadimage_changes","t_value","set_data","t","textfield0_props","textfield1_props","textfield2_props","textfield0_changes","textfield1_changes","textfield2_changes","title_value","if_block","create_if_block","current","profileId","data","loading","isOwner","getProfile","currentProfile","profileData","filename","response","supabase","updates","avatar","error","profile","_profile","$$self","value","isDirty","initialValueOfUserName","initialValueOfFullName","$profile"],"mappings":"6yEACa,CAAA,KAAAA,EAAA,EAAA,EAAAC,EAEA,CAAA,MAAAC,EAAA,MAAA,EAAAD,sLAGXE,EAAA,EAAAC,EAAA,CACE,cAAAC,EAAA,OAAA,GACA,KAAAA,EAAA,MAAA,8lDCPS,CAAA,KAAAL,EAAA,EAAA,EAAAC,EAEA,CAAA,MAAAC,EAAA,MAAA,EAAAD,sLAGXE,EAAA,EAAAC,EAAA,CACE,cAAAC,EAAA,OAAA,GACA,KAAAA,EAAA,MAAA,0JCRJ,MAAAC,GAAA,CAAA,CAAA,OAAAC,EAAA,CAAA,GAAA,EAAA,CAAA,KACA,CACA,UAAAA,EAAA,EACA;;;2HC+GoC,IAAAC,EAAA,CAAA,EAAA,i5GAAAC,EAAA,IAAAC,GAAA,IAAAF,EAAA,CAAA,EAAA,mhBA+BSG,EAAAH,EAAA,CAAA,EAAA,SAAA,+LAAAC,EAAA,GAAAE,KAAAA,EAAAH,EAAA,CAAA,EAAA,SAAA,KAAAI,GAAAC,EAAAF,CAAA,wKA1BvBH,EAAA,CAAA,EAAA,WAAA,SAAAM,EAAA,MAAAN,EAAA,CAAA,EAAA,6JAMAA,EAAA,CAAA,EAAA,WAAA,SAAAO,EAAA,MAAAP,EAAA,CAAA,EAAA,yKAMAA,EAAA,CAAA,EAAA,QAAA,SAAAQ,EAAA,MAAAR,EAAA,CAAA,EAAA,0YAZAS,EAAA,MAAAT,EAAA,CAAA,EAAA,2DAMAU,EAAA,MAAAV,EAAA,CAAA,EAAA,2DAMAW,EAAA,MAAAX,EAAA,CAAA,EAAA,svBA9BD,SAAA,MAAAY,EAAA,cAAAZ,EAAA,CAAA,EAAA,SAId,IAAAa,EAAAb,EAAA,CAAA,EAAA,IAAAc,GAAAd,CAAA,gWAJc,CAAAe,GAAAd,EAAA,IAAAW,KAAAA,EAAA,cAAAZ,EAAA,CAAA,EAAA,8BAIdA,EAAA,CAAA,EAAA,+PA/FG,KAAA,CAAA,UAAAgB,CAAA,EAAAC,QAGJC,EAAA,QAEAC,EAAA,OAGW,eAAAC,EAAAJ,EAAA,CACbrB,EAAA,EAAAuB,EAAA,EAAA,kIAcEG,EAAAC,wCAKF3B,EAAA,EAAAuB,EAAA,EAAA,yBAKEvB,EAAA,EAAAuB,EAAA,EAAA,0DAQQ,MAAAK,EAAA,QAAAF,EAAA,SAAA,KAAA,IAAA,CAAA,oGAQI,KAAA,CAAA,KAAAG,EAAA,EAAAC,GAAA,QAAA,KAAA,SAAA,EAAA,aAAAF,CAAA,EAERG,EAAA,WAAAF,GAAA,UACA7B,EAAA,EAAA0B,EAAA,WAAAG,GAAA,UAAAH,CAAA,EAEF1B,EAAA,EAAAgC,EAAA,MAAA,EAGI,GAAA,CAAA,MAAAC,CAAA,EAAA,MAAAH,GAAA,KAAA,SAAA,EAAA,OAAAC,CAAA,EAAA,MAAA,CAAA,GAAAV,CAAA,CAAA,EASF,MANFa,GAAA,OAAAC,IAAA,CAAA,GAAAA,EAAA,GAAAJ,CAAA,EAAA,EAMEE,EAAA,MAAAA,4BAGJjC,EAAA,EAAAuB,EAAA,EAAA,UAEAvB,EAAA,EAAAuB,EAAA,EAAA,+EAsCgBa,EAAA,GAAA,UAAAV,EAAA,SAAAW,CAAA,IAAAX,EAAA,SAAAW,wBAMAD,EAAA,GAAA,UAAAV,EAAA,SAAAW,CAAA,IAAAX,EAAA,SAAAW,wBAMAD,EAAA,GAAA,UAAAV,EAAA,MAAAW,CAAA,IAAAX,EAAA,MAAAW,yFA3CpBrC,EAAA,EAAAsC,EAAAN,GAAAO,IAAAb,EAAA,UAAAc,IAAAd,EAAA,QAAA,kBAIA1B,EAAA,EAAAwB,EAAAiB,EAAA,KAAApB,CAAA,gBAGAW","x_google_ignoreList":[0,1]}