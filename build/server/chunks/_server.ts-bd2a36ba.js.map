{"version":3,"file":"_server.ts-bd2a36ba.js","sources":["../../../.svelte-kit/adapter-node/entries/endpoints/api/domain/_server.ts.js"],"sourcesContent":[";\n!function() {\n  try {\n    var e = \"undefined\" != typeof window ? window : \"undefined\" != typeof global ? global : \"undefined\" != typeof self ? self : {}, n = new Error().stack;\n    n && (e._sentryDebugIds = e._sentryDebugIds || {}, e._sentryDebugIds[n] = \"1eed7621-4708-4fac-96a5-9d8d5f9e65cf\", e._sentryDebugIdIdentifier = \"sentry-dbid-1eed7621-4708-4fac-96a5-9d8d5f9e65cf\");\n  } catch (e2) {\n  }\n}();\nimport { j as json } from \"../../../../chunks/index.js\";\nimport { g as getSupabase } from \"../../../../chunks/supabase.js\";\nimport \"../../../../chunks/_sentry-release-injection-file.js\";\nimport { b as private_env } from \"../../../../chunks/shared-server.js\";\nconst addDomainToVercel = async (domain) => {\n  return await fetch(\n    `https://api.vercel.com/v10/projects/${private_env.PROJECT_ID_VERCEL}/domains${private_env.TEAM_ID_VERCEL ? `?teamId=${private_env.TEAM_ID_VERCEL}` : \"\"}`,\n    {\n      method: \"POST\",\n      headers: {\n        Authorization: `Bearer ${private_env.AUTH_BEARER_TOKEN}`,\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        name: domain\n        // Optional: Redirect www. to root domain\n        // ...(domain.startsWith(\"www.\") && {\n        //   redirect: domain.replace(\"www.\", \"\"),\n        // }),\n      })\n    }\n  ).then((res) => res.json());\n};\nconst removeDomainFromVercelProject = async (domain) => {\n  return await fetch(\n    `https://api.vercel.com/v9/projects/${private_env.PROJECT_ID_VERCEL}/domains/${domain}${private_env.TEAM_ID_VERCEL ? `?teamId=${private_env.TEAM_ID_VERCEL}` : \"\"}`,\n    {\n      headers: {\n        Authorization: `Bearer ${private_env.AUTH_BEARER_TOKEN}`\n      },\n      method: \"DELETE\"\n    }\n  ).then((res) => res.json());\n};\nconst getConfigResponse = async (domain) => {\n  return await fetch(\n    `https://api.vercel.com/v6/domains/${domain}/config${private_env.TEAM_ID_VERCEL ? `?teamId=${private_env.TEAM_ID_VERCEL}` : \"\"}`,\n    {\n      method: \"GET\",\n      headers: {\n        Authorization: `Bearer ${private_env.AUTH_BEARER_TOKEN}`,\n        \"Content-Type\": \"application/json\"\n      }\n    }\n  ).then((res) => res.json());\n};\nconst supabase = getSupabase();\nasync function POST({ request }) {\n  const { params } = await request.json();\n  const accessToken = request.headers.get(\"Authorization\");\n  console.log(\"/GET api/domain\", params);\n  if (!params?.key || !accessToken) {\n    return json({ success: false, message: \"Missing fields\" }, { status: 400 });\n  }\n  let user;\n  try {\n    const { data } = await supabase.auth.getUser(accessToken);\n    user = data.user;\n  } catch (error) {\n    console.error(error);\n  }\n  if (!user) {\n    return json({ success: false, message: \"Unauthenticated user\" }, { status: 401 });\n  }\n  try {\n    switch (params.key) {\n      case \"verify_domain\": {\n        const configResponse = await getConfigResponse(params.domain);\n        return json({ success: true, verified: !configResponse.misconfigured }, { status: 200 });\n      }\n      case \"add_domain\": {\n        const addDomainResponse = await addDomainToVercel(params.domain);\n        return json({ success: true, data: addDomainResponse }, { status: 200 });\n      }\n      case \"remove_domain\": {\n        const removeDomainResponse = await removeDomainFromVercelProject(params.domain);\n        return json({ success: true, data: removeDomainResponse }, { status: 200 });\n      }\n      default:\n        return json({ success: false, message: \"Invalid key\" }, { status: 400 });\n    }\n  } catch (error) {\n    console.error(error);\n    return json({ success: false, message: \"Internal server error\" }, { status: 500 });\n  }\n}\nexport {\n  POST\n};\n//# sourceMappingURL=_server.ts.js.map\n"],"names":[],"mappings":"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"}