{"version":3,"file":"index6-4a1599e3.js","sources":["../../../.svelte-kit/adapter-node/chunks/index6.js"],"sourcesContent":[";\n!function() {\n  try {\n    var e = \"undefined\" != typeof window ? window : \"undefined\" != typeof global ? global : \"undefined\" != typeof self ? self : {}, n = new Error().stack;\n    n && (e._sentryDebugIds = e._sentryDebugIds || {}, e._sentryDebugIds[n] = \"48de6e1e-8632-49e1-a77c-4b0d42cb7e61\", e._sentryDebugIdIdentifier = \"sentry-dbid-48de6e1e-8632-49e1-a77c-4b0d42cb7e61\");\n  } catch (e2) {\n  }\n}();\nimport { g as get_store_value } from \"./utils.js\";\nimport { g as goto } from \"./navigation.js\";\nimport { s as supabase } from \"./supabase.js\";\nimport { a as currentOrg, o as orgs, R as ROLE, d as ROLE_LABEL, e as orgTeam, f as orgAudience } from \"./org.js\";\nimport \"./_sentry-release-injection-file.js\";\nasync function getOrgTeam(orgId) {\n  const { data, error } = await supabase.from(\"organizationmember\").select(\n    `\n      id,\n      email,\n      verified,\n      role_id,\n      profile(\n        id,\n        fullname,\n        email\n      )\n    `\n  ).eq(\"organization_id\", orgId).neq(\"role_id\", ROLE.STUDENT).order(\"id\", { ascending: false }).returns();\n  const team = [];\n  if (data?.length) {\n    data.forEach((teamMember) => {\n      team.push({\n        id: teamMember.id,\n        email: teamMember?.profile?.email || teamMember.email,\n        verified: teamMember.verified,\n        profileId: teamMember?.profile?.id,\n        fullname: teamMember?.profile?.fullname || \"\",\n        role: ROLE_LABEL[teamMember?.role_id] || \"\",\n        isAdmin: teamMember?.role_id === ROLE.ADMIN\n      });\n    });\n    orgTeam.set(team);\n  }\n  return {\n    team: get_store_value(orgTeam),\n    error\n  };\n}\nasync function getOrganizations(userId, isOrgSite, orgSiteName) {\n  const { data, error } = await supabase.from(\"organizationmember\").select(\n    `\n      id,\n      profile_id,\n      role_id,\n      created_at,\n      organization!organizationmember_organization_id_fkey (\n        *,\n        organization_plan(\n          plan_name,\n          is_active,\n          subscriptionId:lmz_data->id\n        )\n      )\n    `\n  ).eq(\"profile_id\", userId).order(\"id\", { ascending: false }).returns();\n  const orgsArray = [];\n  if (Array.isArray(data) && data.length) {\n    data.forEach((orgMember) => {\n      orgsArray.push({\n        ...orgMember?.organization || {},\n        memberId: orgMember?.id,\n        role_id: parseInt(orgMember?.role_id),\n        shortName: orgMember?.organization?.name?.substring(0, 2)?.toUpperCase() || \"\"\n      });\n    });\n    orgs.set(orgsArray);\n    if (isOrgSite && orgSiteName) {\n      const orgData = orgsArray.find((org) => org.siteName === orgSiteName);\n      if (orgData) {\n        currentOrg.set(orgData);\n      }\n    } else {\n      if (localStorage) {\n        const lastOrgSiteName = localStorage.getItem(\"classroomio_org_sitename\");\n        const lastOrg = orgsArray.find((org) => org.siteName === lastOrgSiteName);\n        if (lastOrg) {\n          currentOrg.set(lastOrg);\n        }\n      }\n      const _currentOrg = get_store_value(currentOrg);\n      if (!_currentOrg.siteName) {\n        currentOrg.set(orgsArray[0]);\n      }\n    }\n  }\n  return {\n    orgs: orgsArray,\n    currentOrg: get_store_value(currentOrg),\n    error\n  };\n}\nasync function getOrgAudience(orgId) {\n  const { data, error } = await supabase.from(\"profile\").select(\n    `\n      id,\n      fullname,\n      email,\n      avatar_url,\n      created_at,\n      groupmember!inner(\n        role_id,\n        group_id:group!inner(\n          organization_id\n        )\n      )\n    `\n  ).eq(\"groupmember.group.organization_id\", orgId).eq(\"groupmember.role_id\", ROLE.STUDENT);\n  console.log(\"data\", data);\n  const audience = (data || []).map((profile) => ({\n    id: profile.id,\n    name: profile.fullname,\n    email: profile.email,\n    avatar_url: profile.avatar_url,\n    date_joined: new Date(profile.created_at).toDateString()\n  }));\n  orgAudience.set(audience);\n  return {\n    audience,\n    error\n  };\n}\nasync function getCourseBySiteName(siteName) {\n  const { data, error } = await supabase.from(\"course\").select(\n    `\n      *,\n      lessons:lesson(count),\n      group!inner(\n        organization!inner(id, name, siteName, avatar_url)\n      )\n    `\n  ).eq(\"group.organization.siteName\", siteName).eq(\"status\", \"ACTIVE\").eq(\"is_published\", true);\n  if (error) {\n    return [];\n  }\n  return data;\n}\nconst CURRENT_ORG_QUERY = `\n  id,\n  name,\n  siteName,\n  avatar_url,\n  landingpage,\n  is_restricted,\n  customization,\n  theme,\n  favicon,\n  customDomain,\n  isCustomDomainVerified,\n  customCode,\n  organization_plan(\n    plan_name,\n    is_active\n  )\n`;\nasync function getCurrentOrg(siteName, justGet = false, isCustomDomain = false) {\n  let response = null;\n  if (isCustomDomain) {\n    response = await supabase.from(\"organization\").select(CURRENT_ORG_QUERY).eq(\"customDomain\", siteName).filter(\"isCustomDomainVerified\", \"eq\", true).returns();\n  } else {\n    response = await supabase.from(\"organization\").select(CURRENT_ORG_QUERY).eq(\"siteName\", siteName).returns();\n  }\n  const { data, error } = response;\n  const isDataEmpty = !data?.[0];\n  if (!justGet && (error || isDataEmpty)) {\n    console.error(\"Error getOrganization\", error);\n    return goto(\"/404\");\n  }\n  if (!justGet) {\n    if (isDataEmpty)\n      return;\n    currentOrg.set(data[0]);\n  } else if (!isDataEmpty) {\n    return data[0];\n  }\n}\nasync function createOrgPlan(params) {\n  return await params.supabase.from(\"organization_plan\").insert({\n    activated_at: (/* @__PURE__ */ new Date()).toDateString(),\n    org_id: params.orgId,\n    triggered_by: params.triggeredBy,\n    plan_name: params.planName,\n    is_active: true,\n    lmz_data: params.data\n  });\n}\nasync function cancelOrgPlan(params) {\n  return await supabase.from(\"organization_plan\").update({\n    is_active: false,\n    deactivated_at: (/* @__PURE__ */ new Date()).toDateString()\n  }).match({\n    plan_name: params.planName,\n    org_id: params.orgId\n  });\n}\nexport {\n  cancelOrgPlan as a,\n  getCourseBySiteName as b,\n  createOrgPlan as c,\n  getOrgTeam as d,\n  getOrganizations as e,\n  getOrgAudience as f,\n  getCurrentOrg as g\n};\n//# sourceMappingURL=index6.js.map\n"],"names":[],"mappings":"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"}